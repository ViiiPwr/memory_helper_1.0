<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆæƒç ç®¡ç† - é…å¯¹é¢˜ç”Ÿæˆå™¨</title>
    <script src="../js/license-manager.js"></script>
    <script src="../js/license-distributor.js"></script>
    <style>
        body {
            font-family: "Segoe UI", "PingFang SC", "Hiragino Sans", Arial, sans-serif;
            padding: 2vw;
            background: #f8f9fa;
            color: #333;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 2rem;
        }

        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .section h2 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .license-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .license-info {
            flex: 1;
        }

        .license-type {
            font-weight: bold;
            color: #2c3e50;
        }

        .license-code {
            font-family: monospace;
            background: #f8f9fa;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 0.25rem 0;
            color: #666;
        }

        .feature-list li:before {
            content: "âœ“ ";
            color: #27ae60;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”‘ æˆæƒç ç®¡ç†ç³»ç»Ÿ</h1>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="section">
            <h2>ğŸ“Š æˆæƒç ç»Ÿè®¡</h2>
            <div class="stats-grid" id="statsGrid">
                <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- éªŒè¯æˆæƒç  -->
        <div class="section">
            <h2>ğŸ” éªŒè¯æˆæƒç </h2>
            <div class="input-group">
                <label for="licenseInput">è¾“å…¥æˆæƒç ï¼š</label>
                <input type="text" id="licenseInput" placeholder="ä¾‹å¦‚ï¼šPAIRING_PREMIUM_XXXXX" />
            </div>
            <button class="btn" onclick="validateLicense()">éªŒè¯æˆæƒç </button>
            <div id="validationResult"></div>
        </div>

        <!-- æ·»åŠ æˆæƒç  -->
        <div class="section">
            <h2>â• æ·»åŠ æˆæƒç </h2>
            <div class="input-group">
                <label for="newLicenseInput">æ–°æˆæƒç ï¼š</label>
                <input type="text" id="newLicenseInput" placeholder="è¾“å…¥æ–°çš„æˆæƒç " />
            </div>
            <button class="btn btn-success" onclick="addLicense()">æ·»åŠ æˆæƒç </button>
            <button class="btn btn-warning" onclick="generateTestLicense()">ç”Ÿæˆé«˜çº§ç‰ˆæˆæƒç </button>
        </div>

        <!-- æˆæƒç åˆ†å‘ -->
        <div class="section">
            <h2>ğŸ“¤ æˆæƒç åˆ†å‘</h2>
            <div class="input-group">
                <label for="distributeLicenseInput">æˆæƒç ï¼š</label>
                <input type="text" id="distributeLicenseInput" placeholder="è¾“å…¥è¦åˆ†å‘çš„æˆæƒç " />
            </div>
            <div class="input-group">
                <label for="distributeTypeSelect">ç±»å‹ï¼š</label>
                <select id="distributeTypeSelect">
                    <option value="premium">é«˜çº§ç‰ˆ</option>
                </select>
            </div>
            <div class="input-group">
                <label for="customerInfoInput">å®¢æˆ·ä¿¡æ¯ï¼š</label>
                <input type="text" id="customerInfoInput" placeholder="å®¢æˆ·å§“å/è”ç³»æ–¹å¼ï¼ˆå¯é€‰ï¼‰" />
            </div>
            <button class="btn btn-success" onclick="distributeLicense()">åˆ†å‘æˆæƒç </button>
            <button class="btn" onclick="refreshDistributionStats()">åˆ·æ–°ç»Ÿè®¡</button>
        </div>

        <!-- åˆ†å‘ç»Ÿè®¡ -->
        <div class="section">
            <h2>ğŸ“Š åˆ†å‘ç»Ÿè®¡</h2>
            <div id="distributionStats">
                <!-- åˆ†å‘ç»Ÿè®¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- æˆæƒç åˆ—è¡¨ -->
        <div class="section">
            <h2>ğŸ“‹ æœ‰æ•ˆæˆæƒç åˆ—è¡¨</h2>
            <button class="btn" onclick="refreshLicenseList()">åˆ·æ–°åˆ—è¡¨</button>
            <div id="licenseList">
                <!-- æˆæƒç åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- æˆæƒç ç±»å‹è¯´æ˜ -->
        <div class="section">
            <h2>ğŸ“– é«˜çº§ç‰ˆæˆæƒç è¯´æ˜</h2>
            <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #ddd;">
                <h3 style="color: #e74c3c; margin-top: 0;">é«˜çº§ç‰ˆ (PAIRING_PREMIUM_)</h3>
                <ul class="feature-list">
                    <li>æ— é™å¡ç»„åˆ›å»º</li>
                    <li>æ•°æ®å¯¼å‡ºåŠŸèƒ½</li>
                    <li>é«˜çº§ç»Ÿè®¡åŠŸèƒ½</li>
                    <li>ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ</li>
                    <li>å®Œæ•´åŠŸèƒ½è®¿é—®</li>
                    <li>æ— ä½¿ç”¨é™åˆ¶</li>
                </ul>
                <p style="margin-top: 1rem; color: #666; font-style: italic;">
                    é«˜çº§ç‰ˆæˆæƒç æä¾›å®Œæ•´çš„åŠŸèƒ½è®¿é—®æƒé™ï¼Œé€‚åˆä¸“ä¸šç”¨æˆ·å’Œå•†ä¸šä½¿ç”¨ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshStats();
            refreshLicenseList();
            refreshDistributionStats();
        });

        // éªŒè¯æˆæƒç 
        function validateLicense() {
            const licenseInput = document.getElementById('licenseInput');
            const resultDiv = document.getElementById('validationResult');
            const licenseCode = licenseInput.value.trim();

            if (!licenseCode) {
                resultDiv.innerHTML = '<div class="alert alert-error">è¯·è¾“å…¥æˆæƒç </div>';
                return;
            }

            const result = licenseManager.validateLicense(licenseCode);
            
            if (result.valid) {
                const licenseInfo = licenseManager.getLicenseInfo(licenseCode);
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <strong>âœ… ${result.message}</strong><br>
                        ç±»å‹: ${licenseInfo.name}<br>
                        æœ‰æ•ˆæœŸ: ${licenseInfo.validUntil}<br>
                        åŠŸèƒ½: ${licenseInfo.features.join(', ')}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="alert alert-error">
                        <strong>âŒ ${result.message}</strong>
                    </div>
                `;
            }
        }

        // æ·»åŠ æˆæƒç 
        function addLicense() {
            const licenseInput = document.getElementById('newLicenseInput');
            const licenseCode = licenseInput.value.trim();

            if (!licenseCode) {
                alert('è¯·è¾“å…¥æˆæƒç ');
                return;
            }

            if (licenseManager.addLicense(licenseCode)) {
                alert('âœ… æˆæƒç æ·»åŠ æˆåŠŸ');
                licenseInput.value = '';
                refreshStats();
                refreshLicenseList();
            } else {
                alert('âŒ æˆæƒç æ ¼å¼ä¸æ­£ç¡®');
            }
        }

        // ç”Ÿæˆé«˜çº§ç‰ˆæˆæƒç 
        function generateTestLicense() {
            const licenseCode = licenseManager.generateLicense('premium');
            
            document.getElementById('newLicenseInput').value = licenseCode;
            alert(`ç”Ÿæˆçš„é«˜çº§ç‰ˆæˆæƒç : ${licenseCode}\nç±»å‹: é«˜çº§ç‰ˆ`);
        }

        // åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
        function refreshStats() {
            const stats = licenseManager.getStats();
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">æ€»æˆæƒç </div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.premium}</div>
                    <div class="stat-label">é«˜çº§ç‰ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${licenseDistributor.getActiveLicenses().length}</div>
                    <div class="stat-label">å·²åˆ†å‘</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${licenseDistributor.getDistributionStats().active}</div>
                    <div class="stat-label">æ´»è·ƒæˆæƒç </div>
                </div>
            `;
        }

        // åˆ·æ–°æˆæƒç åˆ—è¡¨
        function refreshLicenseList() {
            const licenseList = document.getElementById('licenseList');
            const licenses = Array.from(licenseManager.validLicenses);
            
            if (licenses.length === 0) {
                licenseList.innerHTML = '<div class="alert alert-warning">æš‚æ— æˆæƒç </div>';
                return;
            }

            licenseList.innerHTML = licenses.map(license => {
                const licenseInfo = licenseManager.getLicenseInfo(license);
                return `
                    <div class="license-card">
                        <div class="license-info">
                            <div class="license-type">${licenseInfo.name}</div>
                            <div class="license-code">${license}</div>
                            <div style="color: #666; font-size: 0.9rem;">
                                æœ‰æ•ˆæœŸ: ${licenseInfo.validUntil}
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-danger" onclick="removeLicense('${license}')">åˆ é™¤</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ é™¤æˆæƒç 
        function removeLicense(licenseCode) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æˆæƒç  ${licenseCode} å—ï¼Ÿ`)) {
                licenseManager.validLicenses.delete(licenseCode);
                licenseManager.saveUserLicenses();
                refreshStats();
                refreshLicenseList();
                alert('æˆæƒç å·²åˆ é™¤');
            }
        }

        // å›è½¦é”®éªŒè¯æˆæƒç 
        document.getElementById('licenseInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateLicense();
            }
        });

        document.getElementById('newLicenseInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addLicense();
            }
        });

        // åˆ†å‘æˆæƒç 
        function distributeLicense() {
            const licenseInput = document.getElementById('distributeLicenseInput');
            const typeSelect = document.getElementById('distributeTypeSelect');
            const customerInput = document.getElementById('customerInfoInput');
            
            const licenseCode = licenseInput.value.trim();
            const licenseType = typeSelect.value;
            const customerInfo = customerInput.value.trim();

            if (!licenseCode) {
                alert('è¯·è¾“å…¥æˆæƒç ');
                return;
            }

            if (licenseDistributor.distributeLicense(licenseCode, licenseType, customerInfo)) {
                alert('âœ… æˆæƒç åˆ†å‘æˆåŠŸï¼');
                licenseInput.value = '';
                customerInput.value = '';
                refreshDistributionStats();
                refreshLicenseList();
            } else {
                alert('âŒ æˆæƒç åˆ†å‘å¤±è´¥');
            }
        }

        // åˆ·æ–°åˆ†å‘ç»Ÿè®¡
        function refreshDistributionStats() {
            const stats = licenseDistributor.getDistributionStats();
            const statsDiv = document.getElementById('distributionStats');
            
            statsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <div class="stat-card">
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">æ€»åˆ†å‘æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.active}</div>
                        <div class="stat-label">æ´»è·ƒæˆæƒç </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.inactive}</div>
                        <div class="stat-label">å·²åœç”¨</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <h4>æŒ‰ç±»å‹ç»Ÿè®¡ï¼š</h4>
                    <ul>
                        ${Object.entries(stats.byType).map(([type, count]) => 
                            `<li>${type}: ${count}ä¸ª</li>`
                        ).join('')}
                    </ul>
                </div>
            `;
        }
    </script>
</body>

</html> 
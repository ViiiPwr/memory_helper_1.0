<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆæƒç è°ƒè¯• - é…å¯¹é¢˜ç”Ÿæˆå™¨</title>
    <script src="../js/license-manager.js"></script>
    <script src="../js/license-distributor.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .debug-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .btn:hover {
            background: #45a049;
        }

        .result {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” æˆæƒç è°ƒè¯•å·¥å…·</h1>

        <div class="debug-section">
            <h3>1. ç”Ÿæˆæˆæƒç </h3>
            <button class="btn" onclick="generateLicense()">ç”Ÿæˆæ–°æˆæƒç </button>
            <div id="generateResult"></div>
        </div>

        <div class="debug-section">
            <h3>2. åˆ†å‘æˆæƒç </h3>
            <button class="btn" onclick="distributeLicense()">åˆ†å‘æˆæƒç </button>
            <div id="distributeResult"></div>
        </div>

        <div class="debug-section">
            <h3>3. éªŒè¯æˆæƒç </h3>
            <input type="text" id="testLicenseInput" placeholder="è¾“å…¥æˆæƒç " style="padding: 10px; width: 300px;">
            <button class="btn" onclick="testValidation()">éªŒè¯</button>
            <button class="btn" onclick="autoFillTest()">è‡ªåŠ¨å¡«å…¥</button>
            <div id="validationResult"></div>
        </div>

        <div class="debug-section">
            <h3>4. è°ƒè¯•ä¿¡æ¯</h3>
            <button class="btn" onclick="showDebugInfo()">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
            <div id="debugInfo"></div>
        </div>

        <div class="debug-section">
            <h3>5. æ¸…ç†æ•°æ®</h3>
            <button class="btn" onclick="clearData()" style="background: #f44336;">æ¸…ç†æ‰€æœ‰æ•°æ®</button>
            <div id="clearResult"></div>
        </div>
    </div>

    <script>
        let currentLicense = '';

        function generateLicense() {
            currentLicense = licenseManager.generateLicense('premium');
            document.getElementById('generateResult').innerHTML = `
                <div class="result">
                    <h4>âœ… æˆæƒç ç”ŸæˆæˆåŠŸ</h4>
                    <p><strong>æˆæƒç :</strong> ${currentLicense}</p>
                    <p><strong>ç±»å‹:</strong> é«˜çº§ç‰ˆ</p>
                </div>
            `;
        }

        function distributeLicense() {
            if (!currentLicense) {
                alert('è¯·å…ˆç”Ÿæˆæˆæƒç ');
                return;
            }

            const success = licenseDistributor.distributeLicense(
                currentLicense,
                'premium',
                { customer: 'æµ‹è¯•å®¢æˆ·', contact: 'test@example.com' }
            );

            if (success) {
                // é‡æ–°åŠ è½½æˆæƒç ç®¡ç†å™¨
                licenseManager.loadDistributedLicenses();

                document.getElementById('distributeResult').innerHTML = `
                    <div class="result">
                        <h4>âœ… æˆæƒç åˆ†å‘æˆåŠŸ</h4>
                        <p><strong>æˆæƒç :</strong> ${currentLicense}</p>
                        <p><strong>å®¢æˆ·:</strong> æµ‹è¯•å®¢æˆ·</p>
                    </div>
                `;
            } else {
                document.getElementById('distributeResult').innerHTML = `
                    <div class="result error">
                        <h4>âŒ åˆ†å‘å¤±è´¥</h4>
                    </div>
                `;
            }
        }

        function testValidation() {
            const input = document.getElementById('testLicenseInput').value.trim();

            if (!input) {
                alert('è¯·è¾“å…¥æˆæƒç ');
                return;
            }

            const result = licenseManager.validateLicense(input);

            document.getElementById('validationResult').innerHTML = `
                <div class="result ${result.valid ? '' : 'error'}">
                    <h4>${result.valid ? 'âœ… éªŒè¯æˆåŠŸ' : 'âŒ éªŒè¯å¤±è´¥'}</h4>
                    <p><strong>è¾“å…¥:</strong> ${input}</p>
                    <p><strong>ç»“æœ:</strong> ${result.message}</p>
                    <p><strong>ç±»å‹:</strong> ${result.type}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                </div>
            `;
        }

        function autoFillTest() {
            if (currentLicense) {
                document.getElementById('testLicenseInput').value = currentLicense;
            } else {
                alert('è¯·å…ˆç”Ÿæˆæˆæƒç ');
            }
        }

        function showDebugInfo() {
            const distributedLicenses = licenseDistributor.getAllDistributedLicenses();
            const activeLicenses = licenseDistributor.getActiveLicenses();
            const validLicenses = Array.from(licenseManager.validLicenses);

            document.getElementById('debugInfo').innerHTML = `
                <div class="info">
                    <h4>ğŸ“Š è°ƒè¯•ä¿¡æ¯</h4>
                    <p><strong>LicenseManager æœ‰æ•ˆæˆæƒç æ•°é‡:</strong> ${licenseManager.validLicenses.size}</p>
                    <p><strong>LicenseManager æœ‰æ•ˆæˆæƒç åˆ—è¡¨:</strong></p>
                    <pre>${JSON.stringify(validLicenses, null, 2)}</pre>
                    
                    <p><strong>LicenseDistributor åˆ†å‘è®°å½•:</strong></p>
                    <pre>${JSON.stringify(distributedLicenses, null, 2)}</pre>
                    
                    <p><strong>æ´»è·ƒæˆæƒç :</strong></p>
                    <pre>${JSON.stringify(activeLicenses, null, 2)}</pre>
                    
                    <p><strong>localStorage åˆ†å‘è®°å½•:</strong></p>
                    <pre>${localStorage.getItem('pairing_license_distribution') || 'æ— '}</pre>
                </div>
            `;
        }

        function clearData() {
            localStorage.removeItem('pairing_license_distribution');
            localStorage.removeItem('user_licenses');

            // é‡æ–°åˆå§‹åŒ–
            licenseManager.validLicenses.clear();
            licenseManager.loadValidLicenses();

            licenseDistributor.distributedLicenses = [];

            document.getElementById('clearResult').innerHTML = `
                <div class="result">
                    <h4>âœ… æ•°æ®å·²æ¸…ç†</h4>
                    <p>æ‰€æœ‰æˆæƒç æ•°æ®å·²é‡ç½®</p>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function () {
            showDebugInfo();
        });
    </script>
</body>

</html>